{
  "hash": "acb8af003f0882d48ae965295c587131",
  "result": {
    "markdown": "---\nformat: html\n---\n\n\n\n\n# HW Question 1\n\na) A random variable, $\\tilde{x}$, has the PDF, $f_{\\tilde{x}}(x)$. Write the equation to compute its total probability (hint: think area under the curve!). What is the answer to the equation?\n\n$$\\int_{-\\infty}^{\\infty} f_{\\tilde{x}} (x) dx = 1$$\n\nb) A random variable, $\\tilde{x}$, has a uniform distribution between the values 0 and 1. Draw the probability density function (PDF) and Cumulative Density Function (CDF) of $\\tilde{x}$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplotData <- data.frame(\n    x   = c(-0.5, 0, 0, 1, 1, 1.5),\n    pdf = c(0, 0, 1, 1, 0, 0),\n    cdf = c(0, 0, 0, 1, 1, 1))\n\nuniform_pdf <- ggplot(plotData, aes(x = x, y = pdf)) +\n    geom_path(size = 0.5) +\n    labs(x = 'x', y = 'PDF') +\n    theme_bw()\n\nuniform_cdf <- ggplot(plotData, aes(x = x, y = cdf)) +\n    geom_path(size = 0.5) +\n    labs(x =' x', y = 'CDF') +\n    theme_bw()\n\nuniform_pdf + uniform_cdf\n```\n\n::: {.cell-output-display}\n![](figs/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nc) The value of a random variable, $\\tilde{x}$, is determined by rolling one fair, 6-sided dice. Draw the PDF and CDF of $\\tilde{x}$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplotData <- data.frame(\n    x   = seq(6),\n    pdf = rep(1/6, 6))\n\ndice_pdf <- ggplot(plotData, aes(x = x, y = pdf)) +\n    geom_segment(aes(x = x, xend = x, y = 0, yend = pdf), linetype = 'dashed') +\n    geom_point(size = 3) +\n    labs(x = 'x', y = 'PDF') +\n    theme_bw()\n\nplotData <- data.frame(\n    x   = c(0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7),\n    cdf = c(0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6)/6)\ndice_cdf = ggplot(plotData, aes(x = x, y = cdf)) +\n    geom_path(size = 0.5) +\n    labs(x = 'x', y = 'CDF') +\n    scale_x_continuous(breaks = c(0, seq(6), 7)) +\n    theme_bw()\n\ndice_pdf + dice_cdf\n```\n\n::: {.cell-output-display}\n![](figs/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n# HW Question 2\n\na) A consumer is making a choice between two bars of chocolate: milk chocolate $(m)$ and dark chocolate $(d)$. Assume that we know the observed utility of each bar to be $v_m = 3$ and $v_d = 4$. Using a logit model, compute the probabilities of choosing each bar: $P_m$ and $P_d$.\n\n$$P_m = \\frac{e^{v_m}}{e^{v_m} + e^{v_d}} = \\frac{e^3}{e^3 + e^4}$$ \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndenom <- exp(3) + exp(4)\nexp(3) / denom\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.2689414\n```\n:::\n:::\n\n\n$$P_d = \\frac{e^{v_d}}{e^{v_m} + e^{v_d}} = \\frac{e^4}{e^3 + e^4}$$ \n\n\n::: {.cell}\n\n```{.r .cell-code}\nexp(4) / denom\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.7310586\n```\n:::\n:::\n\n\nb) A third bar of chocolate is now added to the choice set. It is the exact same as the milk chocolate bar, but it has a slightly different wrapper (which has no effect on the consumer's utility). Now,  $v_{m1} = v_{m2} = 3$, and $v_d = 4$. Based on the probabilities from question a), what would we expect the probabilities of choosing each bar to be? What probabilities does the logit model produce?\n\nSince the utilities for the two milk chocolate bars are equivalent, we would expect the milk chocolate bars to split the probability from part a:\n\n$$P_{m1} = P_{m2} = \\frac{0.27}{2} = 0.135$$\n\nand the dark chocolate bar should remain the same:\n\n$$P_d = 0.73$$\n\nHowever, when we compute the logit fractions we get the following results:\n\n$$P_{m1} = P_{m2} = \\frac{e^{v_{m1}}}{e^{v_{m1}} + e^{v_{m2}} + e^{v_d}} = \\frac{e^3}{e^3 + e^3 + e^4}$$ \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndenom <- exp(3) + exp(3) + exp(4)\nexp(3) / denom\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.2119416\n```\n:::\n:::\n\n\n$$P_d = \\frac{e^{v_d}}{e^{v_{m1}} + e^{v_{m2}} + e^{v_d}} = \\frac{e^4}{e^3 + e^3 + e^4}$$ \n\n\n::: {.cell}\n\n```{.r .cell-code}\nexp(4) / denom\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.5761169\n```\n:::\n:::\n\n\nWe can see that the IIA property of the logit model is distorting the probabilities away from what we would expect. The predicted probabilities for the milk chocolate bars are higher than we would expect.\n\n\n\n# HW Question 3\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-hover table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Attribute </th>\n   <th style=\"text-align:left;\"> Bar 1 </th>\n   <th style=\"text-align:left;\"> Bar 2 </th>\n   <th style=\"text-align:left;\"> Bar 3 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Price </td>\n   <td style=\"text-align:left;\"> $1.20 </td>\n   <td style=\"text-align:left;\"> $1.50 </td>\n   <td style=\"text-align:left;\"> $3.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> % Cacao </td>\n   <td style=\"text-align:left;\"> 10% </td>\n   <td style=\"text-align:left;\"> 60% </td>\n   <td style=\"text-align:left;\"> 80% </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\na) Write out a model for the observed utility of each chocolate bar in the above set.\n\nLet's say the coefficient for price is $\\beta_1$ and the coefficient for the percent of cacao is $\\beta_2$. The general model for the observed utility would be: \n\n$$v_j = \\beta_1 x_j^{\\mathrm{price}} + \\beta_2 x_j^{\\mathrm{cacao}}$$\n\nThe observed utility for each bar would be: \n\n$$v_1 = \\beta_1(1.20) + \\beta_2(0.1)$$\n$$v_2 = \\beta_1(1.50) + \\beta_2(0.6)$$\n$$v_3 = \\beta_1(3.00) + \\beta_2(0.8)$$\n\nb) If the coefficient for the _price_ attribute was -0.1 and the coefficient for % _Cacao_ attribute was 0.1, what is the difference in the observed utility between bars 3 and 1?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nb1 <- -0.1\nb2 <- 0.1\nv1 <- b1*1.2 + b2*0.1\nv3 <- b1*3.0 + b2*0.8\nv3 - v1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] -0.11\n```\n:::\n:::\n\n\nc) With the addition of the _brand_ attribute, repeat part a.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-hover table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Attribute </th>\n   <th style=\"text-align:left;\"> Bar 1 </th>\n   <th style=\"text-align:left;\"> Bar 2 </th>\n   <th style=\"text-align:left;\"> Bar 3 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Price </td>\n   <td style=\"text-align:left;\"> $1.20 </td>\n   <td style=\"text-align:left;\"> $1.50 </td>\n   <td style=\"text-align:left;\"> $3.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> % Cacao </td>\n   <td style=\"text-align:left;\"> 10% </td>\n   <td style=\"text-align:left;\"> 60% </td>\n   <td style=\"text-align:left;\"> 80% </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Brand </td>\n   <td style=\"text-align:left;\"> Hershey </td>\n   <td style=\"text-align:left;\"> Lindt </td>\n   <td style=\"text-align:left;\"> Ghirardelli </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nLet's say $\\beta_3$ represents the utility of having the brand _Hershey_, and $\\beta_4$ represents the utility of having the brand _Lindt_ (thus setting the reference level to _Ghirardelli_). Then the general model for the observed utility would be: \n\n$$v_j = \\beta_1 x_j^{\\mathrm{price}} + \\beta_2 x_j^{\\mathrm{cacao}} + \\beta_3 \\delta_j^{\\mathrm{hershey}} + \\beta_4 \\delta_j^{\\mathrm{lindt}}$$\n\nThe observed utility for each bar is: \n\n$$v_1 = \\beta_1(1.20) + \\beta_2(0.1) + \\beta_3$$\n$$v_2 = \\beta_1(1.50) + \\beta_2(0.6) + \\beta_4$$\n$$v_3 = \\beta_1(3.00) + \\beta_2(0.8)$$\n\n\n\n# In Class Question 1\n\nLet's say our utility function is:\n\n$$v_j = \\beta_1 x_j^{\\mathrm{price}} + \\beta_2 x_j^{\\mathrm{cacao}} + \\beta_3 \\delta_j^{\\mathrm{hershey}} + \\beta_4 \\delta_j^{\\mathrm{lindt}}$$\n\nAnd we estimate the following coefficients:\n\n<center>\n<div style=\"width:200px\">\n\nParameter | Coefficient \n----------|-----------\n$\\beta_1$ | -0.1\n$\\beta_2$ | 0.1\n$\\beta_3$ | -2.0\n$\\beta_4$ | -0.1\n\n</div>\n</center>\n\na) What are the expected probabilities of choosing each of these bars using a logit model? \n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-hover table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Attribute </th>\n   <th style=\"text-align:left;\"> Bar 1 </th>\n   <th style=\"text-align:left;\"> Bar 2 </th>\n   <th style=\"text-align:left;\"> Bar 3 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Price </td>\n   <td style=\"text-align:left;\"> $1.20 </td>\n   <td style=\"text-align:left;\"> $1.50 </td>\n   <td style=\"text-align:left;\"> $3.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> % Cacao </td>\n   <td style=\"text-align:left;\"> 10% </td>\n   <td style=\"text-align:left;\"> 60% </td>\n   <td style=\"text-align:left;\"> 80% </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Brand </td>\n   <td style=\"text-align:left;\"> Hershey </td>\n   <td style=\"text-align:left;\"> Lindt </td>\n   <td style=\"text-align:left;\"> Ghirardelli </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create the model coefficient variables\nb1 <- -0.1\nb2 <- 0.1\nb3 <- -2.0\nb4 <- -0.1\n\n# Compute the observed utility for each chocolate bar\nv1 <- b1*1.2 + b2*0.1 + b3\nv2 <- b1*1.5 + b2*0.6 + b4\nv3 <- b1*3 + b2*0.8\n\n# Compute the probabilities using the logit fraction\ndenom <- exp(v1) + exp(v2) + exp(v3)\np1 <- exp(v1) / denom\np2 <- exp(v2) / denom\np3 <- exp(v3) / denom\np1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.06925051\n```\n:::\n\n```{.r .cell-code}\np2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.4723548\n```\n:::\n\n```{.r .cell-code}\np3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.4583946\n```\n:::\n:::\n\n\nb) What price would Bar 2 have to be to get a 50% market share? \n\n$$P_2 = \\frac{e^{v_2}}{e^{v_1} + e^{v_2} + e^{v_3}} = 0.5$$\n$$0.5 (e^{v_1} + e^{v_2} + e^{v_3}) = e^{v_2}$$\n$$0.5 (e^{v_1} + e^{v_3}) = 0.5 e^{v_2}$$\n$$e^{v_1} + e^{v_3} = e^{v_2}$$\n$$log(e^{v_1} + e^{v_3}) = v_2$$\n$$log(e^{v_1} + e^{v_3}) = \\beta_1 x^{\\mathrm{price}} + \\beta_2(0.6) + \\beta_4$$\n$$x^{\\mathrm{price}} = \\frac{1}{\\beta_1} \\left[ log(e^{v_1} + e^{v_3}) - \\beta_2(0.6) - \\beta_4 \\right]$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\n(1/ b1) * (log(exp(v1) + exp(v3)) - b2*0.6 - b4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> [1] 0.3930648\n```\n:::\n:::\n\n\n\n\n# In Class Question 2\n\n1. Run the code chunk to read in the `data.csv` file in the \"data\" folder.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read_csv(here('data', 'data.csv'))\n```\n:::\n\n\n2. Write code to estimate the following utility model (HINT: you may need to make some dummy-coded variables!):\n\n$$u_j = \\beta_1 x_j^{\\mathrm{price}} + \\beta_2 x_j^{\\mathrm{\\%cacao}} + \\beta_3 \\delta_j^{\\mathrm{crispy}} + \\beta_4 \\delta_j^{\\mathrm{hershey}} + \\beta_5 \\delta_j^{\\mathrm{lindt}} + \\varepsilon_j$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- dummy_cols(data, \"brand\")\n\nmodel <- logitr(\n  data = data,\n  outcome = \"choice\",\n  obsID = \"obsID\",\n  pars = c(\n    \"price\", \"percent_cacao\", \"crispy_rice\", \"brand_Hershey\", \"brand_Lindt\"\n  )\n)\n\nsummary(model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> =================================================\n#> \n#> Model estimated on: Tue Oct 17 06:57:20 2023 \n#> \n#> Using logitr version: 1.1.0 \n#> \n#> Call:\n#> logitr(data = data, outcome = \"choice\", obsID = \"obsID\", pars = c(\"price\", \n#>     \"percent_cacao\", \"crispy_rice\", \"brand_Hershey\", \"brand_Lindt\"))\n#> \n#> Frequencies of alternatives:\n#>       1       2       3 \n#> 0.32726 0.34271 0.33003 \n#> \n#> Exit Status: 3, Optimization stopped because ftol_rel or ftol_abs was reached.\n#>                                 \n#> Model Type:    Multinomial Logit\n#> Model Space:          Preference\n#> Model Run:                1 of 1\n#> Iterations:                   11\n#> Elapsed Time:        0h:0m:0.08s\n#> Algorithm:        NLOPT_LD_LBFGS\n#> Weights Used?:             FALSE\n#> Robust?                    FALSE\n#> \n#> Model Coefficients: \n#>                Estimate Std. Error  z-value  Pr(>|z|)    \n#> price         -0.475787   0.027972 -17.0096 < 2.2e-16 ***\n#> percent_cacao  0.024138   0.071405   0.3380 0.7353338    \n#> crispy_rice   -0.259773   0.038431  -6.7595 1.384e-11 ***\n#> brand_Hershey -0.549013   0.047727 -11.5033 < 2.2e-16 ***\n#> brand_Lindt   -0.152169   0.045720  -3.3283 0.0008738 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#>                                      \n#> Log-Likelihood:         -4.521636e+03\n#> Null Log-Likelihood:    -4.763583e+03\n#> AIC:                     9.053273e+03\n#> BIC:                     9.085146e+03\n#> McFadden R2:             5.079088e-02\n#> Adj McFadden R2:         4.974125e-02\n#> Number of Observations:  4.336000e+03\n```\n:::\n:::\n\n\n3. Write code to plot the change in utility for the _price_ attribute.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get the estimated coefficients\ncoefs <- coef(model)\n\n# Create data frame for plotting price:\n#   level   = The attribute level (x-axis)\n#   utility = The utility associated with each level (y-axis)\nprice_levels <- unique(data$price)\ndf_price <- data.frame(level = price_levels) %>% \n    mutate(\n      diff    = level - min(level),\n      utility = diff*coefs['price'])\n\n# Get upper and lower bounds (plots should have the same y-axis)\nymin <- floor(min(df_price$utility))\nymax <- ceiling(max(df_price$utility))\n\n# Plot the utility for each attribute\nplot_price <- df_price %>% \n    ggplot() +\n    geom_line(aes(x = level, y = utility)) +\n    scale_y_continuous(limits = c(ymin, ymax)) +\n    labs(x = 'Price ($)', y = 'Utility') +\n    theme_bw()\n\nplot_price\n```\n\n::: {.cell-output-display}\n![](figs/unnamed-chunk-16-1.png){width=696.192}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}